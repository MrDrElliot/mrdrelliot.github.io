<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-us" lang="en-us">
<head>
    










    







<script defer language="javascript" type="text/javascript" src="/js/bundle.min.145453261a7755f5042a854c4213501d215a8fbe34c08d181c40f803f1315e74.js"></script>





  



    
    <meta http-equiv="content-type" content="text/html; charset=utf-8">

    
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    
    <link rel="icon" href=favicon.png>

    
    





  





  
  
  


<!-- Open Graph image and Twitter Card metadata -->

<title itemprop="name">Dr. Elliot - Network Serialization</title>
<meta property="og:title" content=Dr.&#32;Elliot&#32;-&#32;Network&#32;Serialization />
<meta name="twitter:title" content=Dr.&#32;Elliot&#32;-&#32;Network&#32;Serialization />
<meta itemprop="name" content=Dr.&#32;Elliot&#32;-&#32;Network&#32;Serialization />
<meta name="application-name" content=Dr.&#32;Elliot&#32;-&#32;Network&#32;Serialization />
<meta property="og:site_name" content="Dr. Elliot" />


<meta name="description" content="" />
<meta itemprop="description" content="" />
<meta property="og:description" content="" />
<meta name="twitter:description" content="" />


<base href="https://mrdrelliot.github.io/networking/networkserialization/" />
<link rel="canonical" href="https://mrdrelliot.github.io/networking/networkserialization/" itemprop="url" />
<meta name="url" content="https://mrdrelliot.github.io/networking/networkserialization/" />
<meta name="twitter:url" content="https://mrdrelliot.github.io/networking/networkserialization/" />
<meta property="og:url" content="https://mrdrelliot.github.io/networking/networkserialization/" />


<meta property="og:updated_time" content="2024-08-16T10:28:54-05:00" />


<link rel="sitemap" type="application/xml" title="Sitemap" href='https://mrdrelliot.github.io/sitemap.xml' />

<meta name="robots" content="index,follow" />
<meta name="googlebot" content="index,follow" />



<meta property="fb:admins" content="" />


<meta name="apple-mobile-web-app-title" content="Dr. Elliot" />
<meta name="apple-mobile-web-app-capable" content="yes" />
<meta name="apple-mobile-web-app-status-bar-style" content="black" />






<meta name="generator" content="Hugo 0.132.2">


    
    

<link type="text/css" rel="stylesheet" href="/css/bundle.min.94a339836f89f0d25f31980cb6b0631da21e20af128308747ce44e0525eb16ef.css">


    
    <style>
    body {
        --sidebar-bg-color: #202020;
        --sidebar-img-border-color: #515151;
        --sidebar-p-color: #909090;
        --sidebar-h1-color: #FFF;
        --sidebar-a-color: #FFF;
        --sidebar-socials-color: #FFF;
        --text-color: #222;
        --bkg-color: #FAF9F6;
        --post-title-color: #303030;
        --list-color: #5A5A5A;
        --link-color: #268BD2;
        --date-color: #515151;
        --table-border-color: #E5E5E5;
        --table-stripe-color: #F9F9F9;
        --code-color: #000;
        --code-background-color: #E5E5E5;
        --code-block-color: #FFF;
        --code-block-background-color: #272822;
        --moon-sun-color: #FFF;
        --moon-sun-background-color: #515151;
    }
    body.dark-theme {
        --text-color: #EEE;
        --bkg-color: #121212;
        --post-title-color: #DBE2E9;
        --list-color: #9D9D9D;
        --link-color: #268BD2;
        --date-color: #9A9A9A;
        --table-border-color: #515151;
        --table-stripe-color: #202020;
        --code-color: #FFF;
        --code-background-color: #515151;
        --code-block-color: #FFF;
        --code-block-background-color: #272822;
    }
    body {
        background-color: var(--bkg-color);
    }
</style>

</head>

    <body class="dark-theme">
        <div class="wrapper">
            <aside class="sidebar">
    <div class="container sidebar-sticky">
        <div class="light-dark" align="right">
    <button class="btn-light-dark" title="Toggle light/dark mode">
        <svg class="moon" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 16 16">
            <path fill="currentColor" d="M6 .278a.768.768 0 0 1 .08.858a7.208 7.208 0 0 0-.878 3.46c0 4.021 3.278 7.277 7.318 7.277c.527 0 1.04-.055 1.533-.16a.787.787 0 0 1 .81.316a.733.733 0 0 1-.031.893A8.349 8.349 0 0 1 8.344 16C3.734 16 0 12.286 0 7.71C0 4.266 2.114 1.312 5.124.06A.752.752 0 0 1 6 .278z"/>
        </svg>
        <svg class="sun" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 16 16">
            <path fill="currentColor" d="M8 12a4 4 0 1 0 0-8a4 4 0 0 0 0 8zM8 0a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 0zm0 13a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 13zm8-5a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2a.5.5 0 0 1 .5.5zM3 8a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2A.5.5 0 0 1 3 8zm10.657-5.657a.5.5 0 0 1 0 .707l-1.414 1.415a.5.5 0 1 1-.707-.708l1.414-1.414a.5.5 0 0 1 .707 0zm-9.193 9.193a.5.5 0 0 1 0 .707L3.05 13.657a.5.5 0 0 1-.707-.707l1.414-1.414a.5.5 0 0 1 .707 0zm9.193 2.121a.5.5 0 0 1-.707 0l-1.414-1.414a.5.5 0 0 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .707zM4.464 4.465a.5.5 0 0 1-.707 0L2.343 3.05a.5.5 0 1 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .708z"/>
        </svg>
    </button>
</div>

        <div class="sidebar-about">
    <h1 class="brand">
        
            <a href="https://mrdrelliot.github.io/">
                <img src="https://github.com/mrdrelliot.png" alt="brand image">
            </a>
        
        
            <a href="https://mrdrelliot.github.io/">
                <h1>Dr. Elliot</h1>
            </a>
        
    </h1>
    <p class="lead">
    A collection of things I've learned using Unreal Engine.
    </p>
</div>

        <nav>
    <ul class="sidebar-nav">

        
        
        
        
            

            
                
                
                    <li class="heading">
                        <a href="/about/">About</a>
                    </li>
                    
                
            
                
                
            
                
                
            
                
                
            
                
                
            
                
                
            
                
                
            
            
                
                
            
                
                
            
        
        
            

            
                
                
            
                
                
            
                
                
                    <li class="heading">
                        <a href="/general/">General</a>
                    </li>
                    
                        <li class="sub-heading">
                            
                        </li>
                        
                            <li class="bullet">
                                <a href="https://mrdrelliot.github.io/general/bpvscpp/">Blueprint vs C&#43;&#43;: Different Tools for Different Jobs</a>
                            </li>
                        
                            <li class="bullet">
                                <a href="https://mrdrelliot.github.io/general/constexpr/">Constexpr and Consteval</a>
                            </li>
                        
                            <li class="bullet">
                                <a href="https://mrdrelliot.github.io/general/inheritenceoveruse/">Overuse of Inheritence, alternatives.</a>
                            </li>
                        
                            <li class="bullet">
                                <a href="https://mrdrelliot.github.io/general/lambdadangers/">The dangers of Lambdas</a>
                            </li>
                        
                    
                
            
                
                
            
                
                
            
                
                
            
                
                
            
            
                
                
            
                
                
            
        
        
            

            
                
                
            
                
                
            
                
                
            
                
                
            
                
                
            
                
                
            
                
                
                    <li class="heading">
                        <a href="/optimization/">Optimizations</a>
                    </li>
                    
                        <li class="sub-heading">
                            
                        </li>
                        
                            <li class="bullet">
                                <a href="https://mrdrelliot.github.io/optimization/thecastscare/">The Cast Scare</a>
                            </li>
                        
                    
                
            
            
                
                
            
                
                
            
        
        
            

            
                
                
            
                
                
            
                
                
            
                
                
            
                
                
            
                
                
                    <li class="heading">
                        <a href="/networking/">Networking</a>
                    </li>
                    
                        <li class="sub-heading">
                            
                        </li>
                        
                            <li class="bullet">
                                <a href="https://mrdrelliot.github.io/networking/networkserialization/">Network Serialization</a>
                            </li>
                        
                    
                
            
                
                
            
            
                
                
            
                
                
            
        
        
            

            
                
                
            
                
                
            
                
                
            
                
                
            
                
                
                    <li class="heading">
                        <a href="/memory/">Memory</a>
                    </li>
                    
                        <li class="sub-heading">
                            
                        </li>
                        
                            <li class="bullet">
                                <a href="https://mrdrelliot.github.io/memory/tarrayallocators/">TArray Allocators</a>
                            </li>
                        
                            <li class="bullet">
                                <a href="https://mrdrelliot.github.io/memory/templateobjecttypes/">Templated Object Types</a>
                            </li>
                        
                            <li class="bullet">
                                <a href="https://mrdrelliot.github.io/memory/softreferences/">What Are Soft References?</a>
                            </li>
                        
                            <li class="bullet">
                                <a href="https://mrdrelliot.github.io/memory/buffers/">Working With Buffers</a>
                            </li>
                        
                    
                
            
                
                
            
                
                
            
            
                
                
            
                
                
            
        
        
            

            
                
                
            
                
                
                    <li class="heading">
                        <a href="/gas/">Gameplay Ability System</a>
                    </li>
                    
                        <li class="sub-heading">
                            
                        </li>
                        
                            <li class="bullet">
                                <a href="https://mrdrelliot.github.io/gas/intro/">Intro</a>
                            </li>
                        
                    
                
            
                
                
            
                
                
            
                
                
            
                
                
            
                
                
            
            
                
                
            
                
                
            
        

    </ul>
</nav>

        








    <a target="_blank" class="social" title="Discord" href="https://discord.gg/WTqSFrBg6t">
        <svg xmlns="http://www.w3.org/2000/svg" width="1.2em" height="1.2em" viewBox="0 0 24 24">
            <path fill="currentColor" d="M19.27 5.33C17.94 4.71 16.5 4.26 15 4a.09.09 0 0 0-.07.03c-.18.33-.39.76-.53 1.09a16.09 16.09 0 0 0-4.8 0c-.14-.34-.35-.76-.54-1.09c-.01-.02-.04-.03-.07-.03c-1.5.26-2.93.71-4.27 1.33c-.01 0-.02.01-.03.02c-2.72 4.07-3.47 8.03-3.1 11.95c0 .02.01.04.03.05c1.8 1.32 3.53 2.12 5.24 2.65c.03.01.06 0 .07-.02c.4-.55.76-1.13 1.07-1.74c.02-.04 0-.08-.04-.09c-.57-.22-1.11-.48-1.64-.78c-.04-.02-.04-.08-.01-.11c.11-.08.22-.17.33-.25c.02-.02.05-.02.07-.01c3.44 1.57 7.15 1.57 10.55 0c.02-.01.05-.01.07.01c.11.09.22.17.33.26c.04.03.04.09-.01.11c-.52.31-1.07.56-1.64.78c-.04.01-.05.06-.04.09c.32.61.68 1.19 1.07 1.74c.03.01.06.02.09.01c1.72-.53 3.45-1.33 5.25-2.65c.02-.01.03-.03.03-.05c.44-4.53-.73-8.46-3.1-11.95c-.01-.01-.02-.02-.04-.02zM8.52 14.91c-1.03 0-1.89-.95-1.89-2.12s.84-2.12 1.89-2.12c1.06 0 1.9.96 1.89 2.12c0 1.17-.84 2.12-1.89 2.12zm6.97 0c-1.03 0-1.89-.95-1.89-2.12s.84-2.12 1.89-2.12c1.06 0 1.9.96 1.89 2.12c0 1.17-.83 2.12-1.89 2.12z"/>
        </svg>
    </a>










    <a target="_blank" class="social" title="Email" href="mailto://mrdrelliot@gmail.com">
       <svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1.2em" viewBox="0 0 485.211 485.211">
            <path fill="currentColor" d="M301.393,241.631L464.866,424.56H20.332l163.474-182.928l58.801,51.443L301.393,241.631z M462.174,60.651H23.027 l219.579,192.142L462.174,60.651z M324.225,221.67l160.986,180.151V80.792L324.225,221.67z M0,80.792v321.029L160.972,221.64 L0,80.792z"/>
       </svg>
    </a>




        <p class="footnote">
powered by <a target="_blank" href="https://gohugo.io">Hugo</a> | themed with <a target="_blank" href="https://github.com/lukeorth/poison">poison</a>
    <br>
    &copy; 2024 Dr. Elliot. All rights reserved.
</p>

  </div>
</aside>

            <main class="content container">
                <div class="post">
  <div class="info">
  <h1 class="post-title">
    <a href="https://mrdrelliot.github.io/networking/networkserialization/">Network Serialization</a>
  </h1>

  <div class="headline">
    <div>
      
      
      <time datetime=" 2024-08-16T10:28:54-0500" class="post-date">
        August 16, 2024
      </time>
      
      <span> - </span>
      <span class="reading-time">
        
          
        

        <span>10 mins read</span>
      </span>
    </div>

    
  </div>

  
  

  
</div>

  <p>Hello, I wanted to talk about some ways you can improve networking performance in C++ by understanding and implementing efficient network serialization in Unreal Engine. Effective serialization is critical for transmitting data across the network without unnecessary overhead, especially in multiplayer games where bandwidth is limited.</p>
<p>This article assumes basic familiarization with Unreal Engine&rsquo;s networking system.</p>
<h3 id="what-is-network-serialization">What is Network Serialization?</h3>
<p>Serialization in the context of networking refers to the process of converting data into a format that can be easily transmitted over a network and reconstructed later. In Unreal Engine, this process is crucial for ensuring that game states, variables, and objects are accurately synchronized between clients and servers.</p>
<h3 id="unreal-engines-built-in-serialization">Unreal Engine&rsquo;s Built-in Serialization</h3>
<p>Unreal Engine provides built-in support for serialization with its powerful reflection system. This system can automatically serialize properties marked with specific macros, making it easy to sync variables across the network.</p>
<p>Here’s an example of a simple struct that can be serialized, and forcing it to be atomic:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span>USTRUCT(BlueprintType)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">struct</span> <span style="color:#a6e22e">FPlayerData</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    GENERATED_BODY()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    UPROPERTY(EditAnywhere, BlueprintReadWrite, Category<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;Player Data&#34;</span>)
</span></span><span style="display:flex;"><span>    int32 Health;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    UPROPERTY(EditAnywhere, BlueprintReadWrite, Category<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;Player Data&#34;</span>)
</span></span><span style="display:flex;"><span>    int32 Armor;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    UPROPERTY(EditAnywhere, BlueprintReadWrite, Category<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;Player Data&#34;</span>)
</span></span><span style="display:flex;"><span>    FVector Location;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// Serializes the data for network transmission
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">friend</span> FArchive<span style="color:#f92672">&amp;</span> <span style="color:#66d9ef">operator</span><span style="color:#f92672">&lt;&lt;</span>(FArchive<span style="color:#f92672">&amp;</span> Ar, FPlayerData<span style="color:#f92672">&amp;</span> Data)
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        Ar <span style="color:#f92672">&lt;&lt;</span> Data.Health;
</span></span><span style="display:flex;"><span>        Ar <span style="color:#f92672">&lt;&lt;</span> Data.Armor;
</span></span><span style="display:flex;"><span>        Ar <span style="color:#f92672">&lt;&lt;</span> Data.Location;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> Ar;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>};
</span></span></code></pre></div><p>In this example, the <code>FPlayerData</code> struct contains the player&rsquo;s health, armor, and location. The <code>operator&lt;&lt;</code> overload is implemented to serialize these properties, ensuring that they can be packed into a network packet and sent over the network.</p>
<p>A common point of confusion when first learning about any type of serialization in Unreal is the use of the <code>&lt;&lt;</code> operator. This operator works both during <em>reading</em>, and <em>writing</em>. <code>FArchive</code> has functions to determine which mode it&rsquo;s in. Such as
the <code>write</code> mode with <code>Ar.IsSaving</code> or the <code>read</code> mode with <code>Ar.IsLoading</code>. This enables you to control how things get serialized during both read and write operations.</p>
<p>Something important to node about overriding the <code>&lt;&lt;</code> operator, is that it&rsquo;s used for <strong>ALL</strong> types of serialization, not just networking. Don&rsquo;t worry, there are ways to specifically control serialization <strong>ONLY</strong> during network serialization.</p>
<p>Unreal has a powerful <code>Struct Trait</code> System, now forewarning, the syntax may look a bit weird. But here is an example of how we can declare a <code>UStruct</code> with a <code>Network Serializer</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">template</span><span style="color:#f92672">&lt;&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">struct</span> <span style="color:#a6e22e">TStructOpsTypeTraits</span><span style="color:#f92672">&lt;</span>FPlayerData<span style="color:#f92672">&gt;</span> <span style="color:#f92672">:</span> <span style="color:#66d9ef">public</span> TStructOpsTypeTraitsBase2<span style="color:#f92672">&lt;</span>FPlayerData<span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">enum</span>
</span></span><span style="display:flex;"><span>	{
</span></span><span style="display:flex;"><span>		WithNetSerializer <span style="color:#f92672">=</span> true,
</span></span><span style="display:flex;"><span>	};
</span></span><span style="display:flex;"><span>};
</span></span></code></pre></div><p>This <code>TStructOpsTypeTraits</code> lets you define very specific ways a structure gets used, looking inside of <code>Class.h</code> we can see all of the struct traits to cover custom aspects of <code>UStructs</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">/** type traits to cover the custom aspects of a script struct **/</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">template</span> <span style="color:#f92672">&lt;</span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">CPPSTRUCT</span><span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">struct</span> <span style="color:#a6e22e">TStructOpsTypeTraitsBase2</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">enum</span>
</span></span><span style="display:flex;"><span>	{
</span></span><span style="display:flex;"><span>		WithZeroConstructor            <span style="color:#f92672">=</span> false,                         <span style="color:#75715e">// struct can be constructed as a valid object by filling its memory footprint with zeroes.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>		WithNoInitConstructor          <span style="color:#f92672">=</span> false,                         <span style="color:#75715e">// struct has a constructor which takes an EForceInit parameter which will force the constructor to perform initialization, where the default constructor performs &#39;uninitialization&#39;.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>		WithNoDestructor               <span style="color:#f92672">=</span> false,                         <span style="color:#75715e">// struct will not have its destructor called when it is destroyed.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>		WithCopy                       <span style="color:#f92672">=</span> <span style="color:#f92672">!</span>TIsPODType<span style="color:#f92672">&lt;</span>CPPSTRUCT<span style="color:#f92672">&gt;::</span>Value, <span style="color:#75715e">// struct can be copied via its copy assignment operator.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>		WithIdenticalViaEquality       <span style="color:#f92672">=</span> false,                         <span style="color:#75715e">// struct can be compared via its operator==.  This should be mutually exclusive with WithIdentical.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>		WithIdentical                  <span style="color:#f92672">=</span> false,                         <span style="color:#75715e">// struct can be compared via an Identical(const T* Other, uint32 PortFlags) function.  This should be mutually exclusive with WithIdenticalViaEquality.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>		WithExportTextItem             <span style="color:#f92672">=</span> false,                         <span style="color:#75715e">// struct has an ExportTextItem function used to serialize its state into a string.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>		WithImportTextItem             <span style="color:#f92672">=</span> false,                         <span style="color:#75715e">// struct has an ImportTextItem function used to deserialize a string into an object of that class.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>		WithAddStructReferencedObjects <span style="color:#f92672">=</span> false,                         <span style="color:#75715e">// struct has an AddStructReferencedObjects function which allows it to add references to the garbage collector.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>		WithSerializer                 <span style="color:#f92672">=</span> false,                         <span style="color:#75715e">// struct has a Serialize function for serializing its state to an FArchive.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>		WithStructuredSerializer       <span style="color:#f92672">=</span> false,                         <span style="color:#75715e">// struct has a Serialize function for serializing its state to an FStructuredArchive.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>		WithPostSerialize              <span style="color:#f92672">=</span> false,                         <span style="color:#75715e">// struct has a PostSerialize function which is called after it is serialized
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>		WithNetSerializer              <span style="color:#f92672">=</span> false,                         <span style="color:#75715e">// struct has a NetSerialize function for serializing its state to an FArchive used for network replication.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>		WithNetDeltaSerializer         <span style="color:#f92672">=</span> false,                         <span style="color:#75715e">// struct has a NetDeltaSerialize function for serializing differences in state from a previous NetSerialize operation.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>		WithSerializeFromMismatchedTag <span style="color:#f92672">=</span> false,                         <span style="color:#75715e">// struct has a SerializeFromMismatchedTag function for converting from other property tags.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>		WithStructuredSerializeFromMismatchedTag <span style="color:#f92672">=</span> false,               <span style="color:#75715e">// struct has an FStructuredArchive-based SerializeFromMismatchedTag function for converting from other property tags.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>		WithPostScriptConstruct        <span style="color:#f92672">=</span> false,                         <span style="color:#75715e">// struct has a PostScriptConstruct function which is called after it is constructed in blueprints
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>		WithNetSharedSerialization     <span style="color:#f92672">=</span> false,                         <span style="color:#75715e">// struct has a NetSerialize function that does not require the package map to serialize its state.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>		WithGetPreloadDependencies     <span style="color:#f92672">=</span> false,                         <span style="color:#75715e">// struct has a GetPreloadDependencies function to return all objects that will be Preload()ed when the struct is serialized at load time.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>		WithPureVirtual                <span style="color:#f92672">=</span> false,                         <span style="color:#75715e">// struct has PURE_VIRTUAL functions and cannot be constructed when CHECK_PUREVIRTUALS is true
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>		WithFindInnerPropertyInstance  <span style="color:#f92672">=</span> false,							<span style="color:#75715e">// struct has a FindInnerPropertyInstance function that can provide an FProperty and data pointer when given a property FName
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>		WithCanEditChange			   <span style="color:#f92672">=</span> false,							<span style="color:#75715e">// struct has an editor-only CanEditChange function that can conditionally make child properties read-only in the details panel (same idea as UObject::CanEditChange)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	};
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">static</span> <span style="color:#66d9ef">constexpr</span> EPropertyObjectReferenceType WithSerializerObjectReferences <span style="color:#f92672">=</span> EPropertyObjectReferenceType<span style="color:#f92672">::</span>Conservative; <span style="color:#75715e">// struct&#39;s Serialize method(s) may serialize object references of these types - default Conservative means unknown and object reference collector archives should serialize this struct 
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>};
</span></span></code></pre></div><p>To see a very good example of this system in use, we can look at <code>FVector_NetQuantize</code>, located inside of <code>NetSerialization.h</code>.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>USTRUCT(meta <span style="color:#f92672">=</span> (HasNativeMake <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;/Script/Engine.KismetMathLibrary.MakeVector_NetQuantize&#34;</span>, HasNativeBreak <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;/Script/Engine.KismetMathLibrary.BreakVector_NetQuantize&#34;</span>))
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">struct</span> <span style="color:#a6e22e">FVector_NetQuantize</span> <span style="color:#f92672">:</span> <span style="color:#66d9ef">public</span> FVector
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>	GENERATED_USTRUCT_BODY()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	FORCEINLINE FVector_NetQuantize()
</span></span><span style="display:flex;"><span>	{}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">explicit</span> FORCEINLINE <span style="color:#a6e22e">FVector_NetQuantize</span>(EForceInit E)
</span></span><span style="display:flex;"><span>	<span style="color:#f92672">:</span> FVector(E)
</span></span><span style="display:flex;"><span>	{}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	FORCEINLINE <span style="color:#a6e22e">FVector_NetQuantize</span>(<span style="color:#66d9ef">double</span> InX, <span style="color:#66d9ef">double</span> InY, <span style="color:#66d9ef">double</span> InZ)
</span></span><span style="display:flex;"><span>	<span style="color:#f92672">:</span> FVector(InX, InY, InZ)
</span></span><span style="display:flex;"><span>	{}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	FORCEINLINE <span style="color:#a6e22e">FVector_NetQuantize</span>(<span style="color:#66d9ef">const</span> FVector <span style="color:#f92672">&amp;</span>InVec)
</span></span><span style="display:flex;"><span>	{
</span></span><span style="display:flex;"><span>		FVector<span style="color:#f92672">::</span><span style="color:#66d9ef">operator</span><span style="color:#f92672">=</span>(InVec);
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">bool</span> <span style="color:#a6e22e">NetSerialize</span>(FArchive<span style="color:#f92672">&amp;</span> Ar, <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">UPackageMap</span><span style="color:#f92672">*</span> Map, <span style="color:#66d9ef">bool</span><span style="color:#f92672">&amp;</span> bOutSuccess)
</span></span><span style="display:flex;"><span>	{
</span></span><span style="display:flex;"><span>		bOutSuccess <span style="color:#f92672">=</span> SerializePackedVector<span style="color:#f92672">&lt;</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">20</span><span style="color:#f92672">&gt;</span>(<span style="color:#f92672">*</span><span style="color:#66d9ef">this</span>, Ar);
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">return</span> true;
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>};
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">template</span><span style="color:#f92672">&lt;&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">struct</span> <span style="color:#a6e22e">TStructOpsTypeTraits</span><span style="color:#f92672">&lt;</span> FVector_NetQuantize <span style="color:#f92672">&gt;</span> <span style="color:#f92672">:</span> <span style="color:#66d9ef">public</span> TStructOpsTypeTraitsBase2<span style="color:#f92672">&lt;</span> FVector_NetQuantize <span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">enum</span> 
</span></span><span style="display:flex;"><span>	{
</span></span><span style="display:flex;"><span>		WithNetSerializer <span style="color:#f92672">=</span> true,
</span></span><span style="display:flex;"><span>		WithNetSharedSerialization <span style="color:#f92672">=</span> true,
</span></span><span style="display:flex;"><span>	};
</span></span><span style="display:flex;"><span>};
</span></span></code></pre></div><p>Brushing over the boilerplate code, we can see that <code>FVector_NetQuantize</code> implements the trait <code>WithNetSerializer = true</code>, and then the function:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span>	<span style="color:#66d9ef">bool</span> NetSerialize(FArchive<span style="color:#f92672">&amp;</span> Ar, <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">UPackageMap</span><span style="color:#f92672">*</span> Map, <span style="color:#66d9ef">bool</span><span style="color:#f92672">&amp;</span> bOutSuccess)
</span></span></code></pre></div><p>-is implemented, this gives us full access to the FArchive responsible for the network serialization.</p>
<p>Another important trait is <code>WithNetDeltaSerializer</code>, which enables you direct access to determine what changes between two <code>NetSerialize</code> function calls, <code>FFastArraySerializer</code> takes advantage of this.</p>
<h3 id="optimizing-serialization-for-performance">Optimizing Serialization for Performance</h3>
<p>While Unreal Engine handles a lot of serialization automatically, there are ways to optimize it for better performance:</p>
<ol>
<li>
<p><strong>Minimize Data Transmission</strong>: Only serialize and send the data that is absolutely necessary. Avoid transmitting redundant or static data that doesn&rsquo;t change often.</p>
</li>
<li>
<p><strong>Use Compression</strong>: If you’re sending large amounts of data, consider compressing it before serialization. Unreal Engine provides built-in functions like <code>FArchive</code> for this purpose.</p>
</li>
<li>
<p><strong>Custom Serialization</strong>: For complex objects, implement custom serialization logic to control exactly how data is packed and unpacked, which can reduce the size of your network packets.</p>
</li>
</ol>
<h3 id="example-custom-serialization-with-compression">Example: Custom Serialization with Compression</h3>
<p>Here’s a quick example of custom serialization with compression:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#66d9ef">void</span> AMyPlayerState<span style="color:#f92672">::</span>SerializeCompressedData(FArchive<span style="color:#f92672">&amp;</span> Ar)
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> (Ar.IsSaving())
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        TArray<span style="color:#f92672">&lt;</span>uint8<span style="color:#f92672">&gt;</span> UncompressedData;
</span></span><span style="display:flex;"><span>        FMemoryWriter <span style="color:#a6e22e">MemoryWriter</span>(UncompressedData, true);
</span></span><span style="display:flex;"><span>        MemoryWriter <span style="color:#f92672">&lt;&lt;</span> PlayerData;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// Compress the data
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        TArray<span style="color:#f92672">&lt;</span>uint8<span style="color:#f92672">&gt;</span> CompressedData;
</span></span><span style="display:flex;"><span>        FCompression<span style="color:#f92672">::</span>CompressMemory(NAME_Zlib, CompressedData.GetData(), CompressedData.Max(), UncompressedData.GetData(), UncompressedData.Num());
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// Serialize compressed data
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        Ar <span style="color:#f92672">&lt;&lt;</span> CompressedData;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">else</span> <span style="color:#a6e22e">if</span> (Ar.IsLoading())
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        TArray<span style="color:#f92672">&lt;</span>uint8<span style="color:#f92672">&gt;</span> CompressedData;
</span></span><span style="display:flex;"><span>        Ar <span style="color:#f92672">&lt;&lt;</span> CompressedData;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        TArray<span style="color:#f92672">&lt;</span>uint8<span style="color:#f92672">&gt;</span> UncompressedData;
</span></span><span style="display:flex;"><span>        FCompression<span style="color:#f92672">::</span>UncompressMemory(NAME_Zlib, UncompressedData.GetData(), UncompressedData.Max(), CompressedData.GetData(), CompressedData.Num());
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        FMemoryReader MemoryReader(UncompressedData, true);
</span></span><span style="display:flex;"><span>        MemoryReader <span style="color:#f92672">&lt;&lt;</span> PlayerData;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>In this example, data is compressed using the Zlib algorithm before being serialized, reducing the amount of data transmitted over the network. When received, the data is uncompressed and deserialized back into the original format.</p>
<p>Let&rsquo;s say you have a very very large structure, but that structure might not always be full of every piece of information that can be packaged into it, do we still have to replicate all the properties in the struct even if they&rsquo;re empty?
<strong>NO</strong>.</p>
<p>We can take advantage of the NetSerialize and access to the FArchive responsible by implementing something called <code>Bit Counting</code> or <code> Rep Bit Counting</code></p>
<p><code>Bit Counting</code> is when you pack informatin into a bit <code>uint8</code> <code>uint32</code> (or whatever you suits your requirements) and determine what needs to get packaged up during the <code>Ar.IsSaving</code> phase. Let&rsquo;s take a look at <code>FGameplayEffectContext</code> from the <code>Gameplay Ability System</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">bool</span> FGameplayEffectContext<span style="color:#f92672">::</span>NetSerialize(FArchive<span style="color:#f92672">&amp;</span> Ar, <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">UPackageMap</span><span style="color:#f92672">*</span> Map, <span style="color:#66d9ef">bool</span><span style="color:#f92672">&amp;</span> bOutSuccess)
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>	uint8 RepBits <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">if</span> (Ar.IsSaving())
</span></span><span style="display:flex;"><span>	{
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">if</span> (bReplicateInstigator <span style="color:#f92672">&amp;&amp;</span> Instigator.IsValid())
</span></span><span style="display:flex;"><span>		{
</span></span><span style="display:flex;"><span>			RepBits <span style="color:#f92672">|=</span> <span style="color:#ae81ff">1</span> <span style="color:#f92672">&lt;&lt;</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>		}
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">if</span> (bReplicateEffectCauser <span style="color:#f92672">&amp;&amp;</span> EffectCauser.IsValid() )
</span></span><span style="display:flex;"><span>		{
</span></span><span style="display:flex;"><span>			RepBits <span style="color:#f92672">|=</span> <span style="color:#ae81ff">1</span> <span style="color:#f92672">&lt;&lt;</span> <span style="color:#ae81ff">1</span>;
</span></span><span style="display:flex;"><span>		}
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">if</span> (AbilityCDO.IsValid())
</span></span><span style="display:flex;"><span>		{
</span></span><span style="display:flex;"><span>			RepBits <span style="color:#f92672">|=</span> <span style="color:#ae81ff">1</span> <span style="color:#f92672">&lt;&lt;</span> <span style="color:#ae81ff">2</span>;
</span></span><span style="display:flex;"><span>		}
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">if</span> (bReplicateSourceObject <span style="color:#f92672">&amp;&amp;</span> SourceObject.IsValid())
</span></span><span style="display:flex;"><span>		{
</span></span><span style="display:flex;"><span>			RepBits <span style="color:#f92672">|=</span> <span style="color:#ae81ff">1</span> <span style="color:#f92672">&lt;&lt;</span> <span style="color:#ae81ff">3</span>;
</span></span><span style="display:flex;"><span>		}
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">if</span> (Actors.Num() <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">0</span>)
</span></span><span style="display:flex;"><span>		{
</span></span><span style="display:flex;"><span>			RepBits <span style="color:#f92672">|=</span> <span style="color:#ae81ff">1</span> <span style="color:#f92672">&lt;&lt;</span> <span style="color:#ae81ff">4</span>;
</span></span><span style="display:flex;"><span>		}
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">if</span> (HitResult.IsValid())
</span></span><span style="display:flex;"><span>		{
</span></span><span style="display:flex;"><span>			RepBits <span style="color:#f92672">|=</span> <span style="color:#ae81ff">1</span> <span style="color:#f92672">&lt;&lt;</span> <span style="color:#ae81ff">5</span>;
</span></span><span style="display:flex;"><span>		}
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">if</span> (bHasWorldOrigin)
</span></span><span style="display:flex;"><span>		{
</span></span><span style="display:flex;"><span>			RepBits <span style="color:#f92672">|=</span> <span style="color:#ae81ff">1</span> <span style="color:#f92672">&lt;&lt;</span> <span style="color:#ae81ff">6</span>;
</span></span><span style="display:flex;"><span>		}
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	Ar.SerializeBits(<span style="color:#f92672">&amp;</span>RepBits, <span style="color:#ae81ff">7</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">if</span> (RepBits <span style="color:#f92672">&amp;</span> (<span style="color:#ae81ff">1</span> <span style="color:#f92672">&lt;&lt;</span> <span style="color:#ae81ff">0</span>))
</span></span><span style="display:flex;"><span>	{
</span></span><span style="display:flex;"><span>		Ar <span style="color:#f92672">&lt;&lt;</span> Instigator;
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">if</span> (RepBits <span style="color:#f92672">&amp;</span> (<span style="color:#ae81ff">1</span> <span style="color:#f92672">&lt;&lt;</span> <span style="color:#ae81ff">1</span>))
</span></span><span style="display:flex;"><span>	{
</span></span><span style="display:flex;"><span>		Ar <span style="color:#f92672">&lt;&lt;</span> EffectCauser;
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">if</span> (RepBits <span style="color:#f92672">&amp;</span> (<span style="color:#ae81ff">1</span> <span style="color:#f92672">&lt;&lt;</span> <span style="color:#ae81ff">2</span>))
</span></span><span style="display:flex;"><span>	{
</span></span><span style="display:flex;"><span>		Ar <span style="color:#f92672">&lt;&lt;</span> AbilityCDO;
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">if</span> (RepBits <span style="color:#f92672">&amp;</span> (<span style="color:#ae81ff">1</span> <span style="color:#f92672">&lt;&lt;</span> <span style="color:#ae81ff">3</span>))
</span></span><span style="display:flex;"><span>	{
</span></span><span style="display:flex;"><span>		Ar <span style="color:#f92672">&lt;&lt;</span> SourceObject;
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">if</span> (RepBits <span style="color:#f92672">&amp;</span> (<span style="color:#ae81ff">1</span> <span style="color:#f92672">&lt;&lt;</span> <span style="color:#ae81ff">4</span>))
</span></span><span style="display:flex;"><span>	{
</span></span><span style="display:flex;"><span>		SafeNetSerializeTArray_Default<span style="color:#f92672">&lt;</span><span style="color:#ae81ff">31</span><span style="color:#f92672">&gt;</span>(Ar, Actors);
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">if</span> (RepBits <span style="color:#f92672">&amp;</span> (<span style="color:#ae81ff">1</span> <span style="color:#f92672">&lt;&lt;</span> <span style="color:#ae81ff">5</span>))
</span></span><span style="display:flex;"><span>	{
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">if</span> (Ar.IsLoading())
</span></span><span style="display:flex;"><span>		{
</span></span><span style="display:flex;"><span>			<span style="color:#66d9ef">if</span> (<span style="color:#f92672">!</span>HitResult.IsValid())
</span></span><span style="display:flex;"><span>			{
</span></span><span style="display:flex;"><span>				HitResult <span style="color:#f92672">=</span> TSharedPtr<span style="color:#f92672">&lt;</span>FHitResult<span style="color:#f92672">&gt;</span>(<span style="color:#66d9ef">new</span> FHitResult());
</span></span><span style="display:flex;"><span>			}
</span></span><span style="display:flex;"><span>		}
</span></span><span style="display:flex;"><span>		HitResult<span style="color:#f92672">-&gt;</span>NetSerialize(Ar, Map, bOutSuccess);
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">if</span> (RepBits <span style="color:#f92672">&amp;</span> (<span style="color:#ae81ff">1</span> <span style="color:#f92672">&lt;&lt;</span> <span style="color:#ae81ff">6</span>))
</span></span><span style="display:flex;"><span>	{
</span></span><span style="display:flex;"><span>		Ar <span style="color:#f92672">&lt;&lt;</span> WorldOrigin;
</span></span><span style="display:flex;"><span>		bHasWorldOrigin <span style="color:#f92672">=</span> true;
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">else</span>
</span></span><span style="display:flex;"><span>	{
</span></span><span style="display:flex;"><span>		bHasWorldOrigin <span style="color:#f92672">=</span> false;
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">if</span> (Ar.IsLoading())
</span></span><span style="display:flex;"><span>	{
</span></span><span style="display:flex;"><span>		AddInstigator(Instigator.Get(), EffectCauser.Get()); <span style="color:#75715e">// Just to initialize InstigatorAbilitySystemComponent
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	}	
</span></span><span style="display:flex;"><span>	
</span></span><span style="display:flex;"><span>	bOutSuccess <span style="color:#f92672">=</span> true;
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">return</span> true;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>What in the world is this giant thing? Well it&rsquo;s actually pretty simple, you see <code>FGameplayEffectContext</code> is a very large struct. <code>size: 128, alignment: 8</code>, and we might not always have every bit of information packed into every one of those variables. So we can take advantage of <code>bit counting</code> to determine what actually needs to get serialized up.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	uint8 RepBits <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">if</span> (Ar.IsSaving())
</span></span><span style="display:flex;"><span>	{
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">if</span> (bReplicateInstigator <span style="color:#f92672">&amp;&amp;</span> Instigator.IsValid())
</span></span><span style="display:flex;"><span>		{
</span></span><span style="display:flex;"><span>			RepBits <span style="color:#f92672">|=</span> <span style="color:#ae81ff">1</span> <span style="color:#f92672">&lt;&lt;</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>		}
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">if</span> (bReplicateEffectCauser <span style="color:#f92672">&amp;&amp;</span> EffectCauser.IsValid() )
</span></span><span style="display:flex;"><span>		{
</span></span><span style="display:flex;"><span>			RepBits <span style="color:#f92672">|=</span> <span style="color:#ae81ff">1</span> <span style="color:#f92672">&lt;&lt;</span> <span style="color:#ae81ff">1</span>;
</span></span><span style="display:flex;"><span>		}
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">if</span> (AbilityCDO.IsValid())
</span></span><span style="display:flex;"><span>		{
</span></span><span style="display:flex;"><span>			RepBits <span style="color:#f92672">|=</span> <span style="color:#ae81ff">1</span> <span style="color:#f92672">&lt;&lt;</span> <span style="color:#ae81ff">2</span>;
</span></span><span style="display:flex;"><span>		}
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">if</span> (bReplicateSourceObject <span style="color:#f92672">&amp;&amp;</span> SourceObject.IsValid())
</span></span><span style="display:flex;"><span>		{
</span></span><span style="display:flex;"><span>			RepBits <span style="color:#f92672">|=</span> <span style="color:#ae81ff">1</span> <span style="color:#f92672">&lt;&lt;</span> <span style="color:#ae81ff">3</span>;
</span></span><span style="display:flex;"><span>		}
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">if</span> (Actors.Num() <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">0</span>)
</span></span><span style="display:flex;"><span>		{
</span></span><span style="display:flex;"><span>			RepBits <span style="color:#f92672">|=</span> <span style="color:#ae81ff">1</span> <span style="color:#f92672">&lt;&lt;</span> <span style="color:#ae81ff">4</span>;
</span></span><span style="display:flex;"><span>		}
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">if</span> (HitResult.IsValid())
</span></span><span style="display:flex;"><span>		{
</span></span><span style="display:flex;"><span>			RepBits <span style="color:#f92672">|=</span> <span style="color:#ae81ff">1</span> <span style="color:#f92672">&lt;&lt;</span> <span style="color:#ae81ff">5</span>;
</span></span><span style="display:flex;"><span>		}
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">if</span> (bHasWorldOrigin)
</span></span><span style="display:flex;"><span>		{
</span></span><span style="display:flex;"><span>			RepBits <span style="color:#f92672">|=</span> <span style="color:#ae81ff">1</span> <span style="color:#f92672">&lt;&lt;</span> <span style="color:#ae81ff">6</span>;
</span></span><span style="display:flex;"><span>		}
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>    
</span></span></code></pre></div><p>This part here, only happens when the <code>FArchive</code> is in the <em>write</em> mode, at that time, you determine which properties have relevant values, and simply mark a <code>flag</code> into the <code>uint8 RepBits</code>, stating that something exists at that point we may want later.</p>
<p>The next part happens for both <em>writing</em> and <em>reading</em>. At whichtime the <code>RepBits</code> is serialized to the number of entries we put into it, (in this case 7 bits), and then as we come through the struct, we look and see which properties are relevant, and if they are. We serialize them with the <code>&lt;&lt;</code> operator, or by calling the property&rsquo;s custom <code>NetSerialize</code> function. When this gets <em>read</em> on the other side, the order is maintained through the <code>RepBits</code>, so the reader has the
ability to unpack the structure in the correct order. Which is *<em>Extremely</em> important. Both <em>reading</em> and <em>writing</em> needs to happen in the same order, due to how buffers work. We use the <code>uint8</code> to maintain a small way to send the data through the network which contains our information about what was actually read to the archiver.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Ar.SerializeBits(<span style="color:#f92672">&amp;</span>RepBits, <span style="color:#ae81ff">7</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">if</span> (RepBits <span style="color:#f92672">&amp;</span> (<span style="color:#ae81ff">1</span> <span style="color:#f92672">&lt;&lt;</span> <span style="color:#ae81ff">0</span>))
</span></span><span style="display:flex;"><span>	{
</span></span><span style="display:flex;"><span>		Ar <span style="color:#f92672">&lt;&lt;</span> Instigator;
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">if</span> (RepBits <span style="color:#f92672">&amp;</span> (<span style="color:#ae81ff">1</span> <span style="color:#f92672">&lt;&lt;</span> <span style="color:#ae81ff">1</span>))
</span></span><span style="display:flex;"><span>	{
</span></span><span style="display:flex;"><span>		Ar <span style="color:#f92672">&lt;&lt;</span> EffectCauser;
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">if</span> (RepBits <span style="color:#f92672">&amp;</span> (<span style="color:#ae81ff">1</span> <span style="color:#f92672">&lt;&lt;</span> <span style="color:#ae81ff">2</span>))
</span></span><span style="display:flex;"><span>	{
</span></span><span style="display:flex;"><span>		Ar <span style="color:#f92672">&lt;&lt;</span> AbilityCDO;
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">if</span> (RepBits <span style="color:#f92672">&amp;</span> (<span style="color:#ae81ff">1</span> <span style="color:#f92672">&lt;&lt;</span> <span style="color:#ae81ff">3</span>))
</span></span><span style="display:flex;"><span>	{
</span></span><span style="display:flex;"><span>		Ar <span style="color:#f92672">&lt;&lt;</span> SourceObject;
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">if</span> (RepBits <span style="color:#f92672">&amp;</span> (<span style="color:#ae81ff">1</span> <span style="color:#f92672">&lt;&lt;</span> <span style="color:#ae81ff">4</span>))
</span></span><span style="display:flex;"><span>	{
</span></span><span style="display:flex;"><span>		SafeNetSerializeTArray_Default<span style="color:#f92672">&lt;</span><span style="color:#ae81ff">31</span><span style="color:#f92672">&gt;</span>(Ar, Actors);
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">if</span> (RepBits <span style="color:#f92672">&amp;</span> (<span style="color:#ae81ff">1</span> <span style="color:#f92672">&lt;&lt;</span> <span style="color:#ae81ff">5</span>))
</span></span><span style="display:flex;"><span>	{
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">if</span> (Ar.IsLoading())
</span></span><span style="display:flex;"><span>		{
</span></span><span style="display:flex;"><span>			<span style="color:#66d9ef">if</span> (<span style="color:#f92672">!</span>HitResult.IsValid())
</span></span><span style="display:flex;"><span>			{
</span></span><span style="display:flex;"><span>				HitResult <span style="color:#f92672">=</span> TSharedPtr<span style="color:#f92672">&lt;</span>FHitResult<span style="color:#f92672">&gt;</span>(<span style="color:#66d9ef">new</span> FHitResult());
</span></span><span style="display:flex;"><span>			}
</span></span><span style="display:flex;"><span>		}
</span></span><span style="display:flex;"><span>		HitResult<span style="color:#f92672">-&gt;</span>NetSerialize(Ar, Map, bOutSuccess);
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">if</span> (RepBits <span style="color:#f92672">&amp;</span> (<span style="color:#ae81ff">1</span> <span style="color:#f92672">&lt;&lt;</span> <span style="color:#ae81ff">6</span>))
</span></span><span style="display:flex;"><span>	{
</span></span><span style="display:flex;"><span>		Ar <span style="color:#f92672">&lt;&lt;</span> WorldOrigin;
</span></span><span style="display:flex;"><span>		bHasWorldOrigin <span style="color:#f92672">=</span> true;
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">else</span>
</span></span><span style="display:flex;"><span>	{
</span></span><span style="display:flex;"><span>		bHasWorldOrigin <span style="color:#f92672">=</span> false;
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">if</span> (Ar.IsLoading())
</span></span><span style="display:flex;"><span>	{
</span></span><span style="display:flex;"><span>		AddInstigator(Instigator.Get(), EffectCauser.Get()); <span style="color:#75715e">// Just to initialize InstigatorAbilitySystemComponent
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	}	
</span></span><span style="display:flex;"><span>	
</span></span><span style="display:flex;"><span>	bOutSuccess <span style="color:#f92672">=</span> true;
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">return</span> true;
</span></span><span style="display:flex;"><span>    
</span></span></code></pre></div><h3 id="conclusion">Conclusion</h3>
<p>Efficient network serialization is essential for any multiplayer game developed in Unreal Engine. By understanding and optimizing how data is serialized, you can significantly reduce network overhead, leading to smoother and more responsive gameplay.</p>
<p>If you’re looking to enhance your game’s networking performance, start by analyzing what data you’re sending across the network and consider implementing custom serialization strategies to optimize it.</p>
<hr>
<p>By following these guidelines and examples, you&rsquo;ll be well on your way to improving your Unreal Engine project&rsquo;s networking performance. Happy coding!</p>

  
  <hr>
<div class="footer">
    
	    
	    
    
</div>

  
</div>
            </main>
            
  
    <div class="article-toc ">
    <div class="toc-wrapper">
      <h4 id="contents"></h4>
      <nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#what-is-network-serialization">What is Network Serialization?</a></li>
        <li><a href="#unreal-engines-built-in-serialization">Unreal Engine&rsquo;s Built-in Serialization</a></li>
        <li><a href="#optimizing-serialization-for-performance">Optimizing Serialization for Performance</a></li>
        <li><a href="#example-custom-serialization-with-compression">Example: Custom Serialization with Compression</a></li>
        <li><a href="#conclusion">Conclusion</a></li>
      </ul>
    </li>
  </ul>
</nav>
    </div>
</div>

  

        </div>
    </body>
</html>
