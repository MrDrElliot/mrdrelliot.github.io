<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-us" lang="en-us">
<head>
    










    







<script defer language="javascript" type="text/javascript" src="/js/bundle.min.145453261a7755f5042a854c4213501d215a8fbe34c08d181c40f803f1315e74.js"></script>





  



    
    <meta http-equiv="content-type" content="text/html; charset=utf-8">

    
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    
    <link rel="icon" href=/favicon.png>

    
    





  





  
  
  


<!-- Open Graph image and Twitter Card metadata -->

<title itemprop="name">Dr. Elliot - Working With Buffers</title>
<meta property="og:title" content=Dr.&#32;Elliot&#32;-&#32;Working&#32;With&#32;Buffers />
<meta name="twitter:title" content=Dr.&#32;Elliot&#32;-&#32;Working&#32;With&#32;Buffers />
<meta itemprop="name" content=Dr.&#32;Elliot&#32;-&#32;Working&#32;With&#32;Buffers />
<meta name="application-name" content=Dr.&#32;Elliot&#32;-&#32;Working&#32;With&#32;Buffers />
<meta property="og:site_name" content="Dr. Elliot" />


<meta name="description" content="" />
<meta itemprop="description" content="" />
<meta property="og:description" content="" />
<meta name="twitter:description" content="" />


<base href="https://mrdrelliot.github.io/posts/memory/buffers/" />
<link rel="canonical" href="https://mrdrelliot.github.io/posts/memory/buffers/" itemprop="url" />
<meta name="url" content="https://mrdrelliot.github.io/posts/memory/buffers/" />
<meta name="twitter:url" content="https://mrdrelliot.github.io/posts/memory/buffers/" />
<meta property="og:url" content="https://mrdrelliot.github.io/posts/memory/buffers/" />


<meta property="og:updated_time" content="2024-08-16T12:28:45-05:00" />


<link rel="sitemap" type="application/xml" title="Sitemap" href='https://mrdrelliot.github.io/sitemap.xml' />

<meta name="robots" content="index,follow" />
<meta name="googlebot" content="index,follow" />



<meta property="fb:admins" content="" />


<meta name="apple-mobile-web-app-title" content="Dr. Elliot" />
<meta name="apple-mobile-web-app-capable" content="yes" />
<meta name="apple-mobile-web-app-status-bar-style" content="black" />






<meta name="generator" content="Hugo 0.132.2">


    
    

<link type="text/css" rel="stylesheet" href="/css/bundle.min.94a339836f89f0d25f31980cb6b0631da21e20af128308747ce44e0525eb16ef.css">


    
    <style>
    body {
        --sidebar-bg-color: #202020;
        --sidebar-img-border-color: #515151;
        --sidebar-p-color: #909090;
        --sidebar-h1-color: #FFF;
        --sidebar-a-color: #FFF;
        --sidebar-socials-color: #FFF;
        --text-color: #222;
        --bkg-color: #FAF9F6;
        --post-title-color: #303030;
        --list-color: #5A5A5A;
        --link-color: #268BD2;
        --date-color: #515151;
        --table-border-color: #E5E5E5;
        --table-stripe-color: #F9F9F9;
        --code-color: #000;
        --code-background-color: #E5E5E5;
        --code-block-color: #FFF;
        --code-block-background-color: #272822;
        --moon-sun-color: #FFF;
        --moon-sun-background-color: #515151;
    }
    body.dark-theme {
        --text-color: #EEE;
        --bkg-color: #121212;
        --post-title-color: #DBE2E9;
        --list-color: #9D9D9D;
        --link-color: #268BD2;
        --date-color: #9A9A9A;
        --table-border-color: #515151;
        --table-stripe-color: #202020;
        --code-color: #FFF;
        --code-background-color: #515151;
        --code-block-color: #FFF;
        --code-block-background-color: #272822;
    }
    body {
        background-color: var(--bkg-color);
    }
</style>

</head>

    <body class="dark-theme">
        <div class="wrapper">
            <aside class="sidebar">
    <div class="container sidebar-sticky">
        <div class="light-dark" align="right">
    <button class="btn-light-dark" title="Toggle light/dark mode">
        <svg class="moon" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 16 16">
            <path fill="currentColor" d="M6 .278a.768.768 0 0 1 .08.858a7.208 7.208 0 0 0-.878 3.46c0 4.021 3.278 7.277 7.318 7.277c.527 0 1.04-.055 1.533-.16a.787.787 0 0 1 .81.316a.733.733 0 0 1-.031.893A8.349 8.349 0 0 1 8.344 16C3.734 16 0 12.286 0 7.71C0 4.266 2.114 1.312 5.124.06A.752.752 0 0 1 6 .278z"/>
        </svg>
        <svg class="sun" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 16 16">
            <path fill="currentColor" d="M8 12a4 4 0 1 0 0-8a4 4 0 0 0 0 8zM8 0a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 0zm0 13a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 13zm8-5a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2a.5.5 0 0 1 .5.5zM3 8a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2A.5.5 0 0 1 3 8zm10.657-5.657a.5.5 0 0 1 0 .707l-1.414 1.415a.5.5 0 1 1-.707-.708l1.414-1.414a.5.5 0 0 1 .707 0zm-9.193 9.193a.5.5 0 0 1 0 .707L3.05 13.657a.5.5 0 0 1-.707-.707l1.414-1.414a.5.5 0 0 1 .707 0zm9.193 2.121a.5.5 0 0 1-.707 0l-1.414-1.414a.5.5 0 0 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .707zM4.464 4.465a.5.5 0 0 1-.707 0L2.343 3.05a.5.5 0 1 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .708z"/>
        </svg>
    </button>
</div>

        <div class="sidebar-about">
    <h1 class="brand">
        
        
            <a href="https://mrdrelliot.github.io/">
                <h1>Dr. Elliot</h1>
            </a>
        
    </h1>
    <p class="lead">
    A collection of things I've learned using Unreal Engine.
    </p>
</div>

        <nav>
    <ul class="sidebar-nav">

        
        
        
        
            

            
                
                
                    <li class="heading">
                        <a href="/about/">About</a>
                    </li>
                    
                
            
                
                
            
            
                
                
            
                
                
            
        
        
            

            
                
                
            
                
                
            
            
                
                
            
                
                
            
        
        
            

            
                
                
            
                
                
            
            
                
                
            
                
                
            
        
        
            

            
                
                
            
                
                
            
            
                
                
            
                
                
            
        
        
            

            
                
                
            
                
                
            
            
                
                
            
                
                
            
        

    </ul>
</nav>

        








    <a target="_blank" class="social" title="Discord" href="https://discord.gg/WTqSFrBg6t">
        <svg xmlns="http://www.w3.org/2000/svg" width="1.2em" height="1.2em" viewBox="0 0 24 24">
            <path fill="currentColor" d="M19.27 5.33C17.94 4.71 16.5 4.26 15 4a.09.09 0 0 0-.07.03c-.18.33-.39.76-.53 1.09a16.09 16.09 0 0 0-4.8 0c-.14-.34-.35-.76-.54-1.09c-.01-.02-.04-.03-.07-.03c-1.5.26-2.93.71-4.27 1.33c-.01 0-.02.01-.03.02c-2.72 4.07-3.47 8.03-3.1 11.95c0 .02.01.04.03.05c1.8 1.32 3.53 2.12 5.24 2.65c.03.01.06 0 .07-.02c.4-.55.76-1.13 1.07-1.74c.02-.04 0-.08-.04-.09c-.57-.22-1.11-.48-1.64-.78c-.04-.02-.04-.08-.01-.11c.11-.08.22-.17.33-.25c.02-.02.05-.02.07-.01c3.44 1.57 7.15 1.57 10.55 0c.02-.01.05-.01.07.01c.11.09.22.17.33.26c.04.03.04.09-.01.11c-.52.31-1.07.56-1.64.78c-.04.01-.05.06-.04.09c.32.61.68 1.19 1.07 1.74c.03.01.06.02.09.01c1.72-.53 3.45-1.33 5.25-2.65c.02-.01.03-.03.03-.05c.44-4.53-.73-8.46-3.1-11.95c-.01-.01-.02-.02-.04-.02zM8.52 14.91c-1.03 0-1.89-.95-1.89-2.12s.84-2.12 1.89-2.12c1.06 0 1.9.96 1.89 2.12c0 1.17-.84 2.12-1.89 2.12zm6.97 0c-1.03 0-1.89-.95-1.89-2.12s.84-2.12 1.89-2.12c1.06 0 1.9.96 1.89 2.12c0 1.17-.83 2.12-1.89 2.12z"/>
        </svg>
    </a>













        <p class="footnote">
powered by <a target="_blank" href="https://gohugo.io">Hugo</a> | themed with <a target="_blank" href="https://github.com/lukeorth/poison">poison</a>
    <br>
    &copy; 2024 Dr. Elliot. All rights reserved.
</p>

  </div>
</aside>

            <main class="content container">
                <div class="post">
  <div class="info">
  <h1 class="post-title">
    <a href="https://mrdrelliot.github.io/posts/memory/buffers/">Working With Buffers</a>
  </h1>

  <div class="headline">
    <div>
      
      
      <time datetime=" 2024-08-16T12:28:45-0500" class="post-date">
        August 16, 2024
      </time>
      
      <span> - </span>
      <span class="reading-time">
        
          
        

        <span>2 mins read</span>
      </span>
    </div>

    
  </div>

  
  

  
</div>

  <p>In Unreal Engine, buffers are simply containers of bytes that can store raw data using memory offsets. Understanding how to effectively manage these buffers is essential for tasks like serialization, deserialization, and data storage.</p>
<h2 id="raw-c-buffer-management">Raw C++ Buffer Management</h2>
<p>In raw C++, managing buffers and packing data requires manual handling of memory offsets. For example, consider the following code that packs several <code>uint32_t</code> values into a <code>std::vector&lt;std::byte&gt;</code> buffer:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#75715e">#include</span> <span style="color:#75715e">&lt;vector&gt;</span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#include</span> <span style="color:#75715e">&lt;cstdint&gt;</span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#include</span> <span style="color:#75715e">&lt;cstring&gt;</span><span style="color:#75715e">  </span><span style="color:#75715e">// For std::memcpy
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">void</span> <span style="color:#a6e22e">PackData</span>()
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// Buffer to hold the packed data
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    std<span style="color:#f92672">::</span>vector<span style="color:#f92672">&lt;</span>std<span style="color:#f92672">::</span>byte<span style="color:#f92672">&gt;</span> buffer;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// Example data
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    std<span style="color:#f92672">::</span>vector<span style="color:#f92672">&lt;</span><span style="color:#66d9ef">uint32_t</span><span style="color:#f92672">&gt;</span> data <span style="color:#f92672">=</span> { <span style="color:#ae81ff">1234</span>, <span style="color:#ae81ff">5678</span>, <span style="color:#ae81ff">91011</span> };
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// Calculate the total size needed for the buffer
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    size_t totalSize <span style="color:#f92672">=</span> data.size() <span style="color:#f92672">*</span> <span style="color:#66d9ef">sizeof</span>(<span style="color:#66d9ef">uint32_t</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// Resize the buffer to fit the data
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    buffer.resize(totalSize);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// Copy each uint32_t into the buffer
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">for</span> (size_t i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; i <span style="color:#f92672">&lt;</span> data.size(); <span style="color:#f92672">++</span>i)
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// Calculate the offset in the buffer
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        size_t offset <span style="color:#f92672">=</span> i <span style="color:#f92672">*</span> <span style="color:#66d9ef">sizeof</span>(<span style="color:#66d9ef">uint32_t</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// Use std::memcpy to copy the data
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        std<span style="color:#f92672">::</span>memcpy(buffer.data() <span style="color:#f92672">+</span> offset, <span style="color:#f92672">&amp;</span>data[i], <span style="color:#66d9ef">sizeof</span>(<span style="color:#66d9ef">uint32_t</span>));
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>In this example, the buffer is resized to hold the data, and each <code>uint32_t</code> value is copied into the buffer at the appropriate offset.</p>
<h2 id="simplified-buffer-management-in-unreal-engine">Simplified Buffer Management in Unreal Engine</h2>
<p>Unreal Engine simplifies this process with its <code>FMemoryReader</code> and <code>FMemoryWriter</code> classes. These classes handle the serialization and deserialization of data, abstracting away manual memory management.</p>
<h3 id="using-fmemorywriter">Using <strong>FMemoryWriter</strong></h3>
<p>To write data to a buffer, use <code>FMemoryWriter</code>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#75715e">#include</span> <span style="color:#75715e">&#34;Serialization/MemoryWriter.h&#34;</span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#include</span> <span style="color:#75715e">&#34;Containers/Array.h&#34;</span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">void</span> <span style="color:#a6e22e">SerializeData</span>()
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    int32 SomeInt <span style="color:#f92672">=</span> <span style="color:#ae81ff">32</span>;
</span></span><span style="display:flex;"><span>    TArray<span style="color:#f92672">&lt;</span>uint8<span style="color:#f92672">&gt;</span> Buffer;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// Create a memory writer to serialize data
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        FMemoryWriter Writer(Buffer, true <span style="color:#75715e">/*bSerializeAsSingleBlock*/</span>);
</span></span><span style="display:flex;"><span>        Writer <span style="color:#f92672">&lt;&lt;</span> SomeInt;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h3 id="using-fmemoryreader">Using <strong>FMemoryReader</strong></h3>
<p>To read data from a buffer, use <code>FMemoryReader</code>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#75715e">#include</span> <span style="color:#75715e">&#34;Serialization/MemoryReader.h&#34;</span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#include</span> <span style="color:#75715e">&#34;Containers/Array.h&#34;</span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">void</span> <span style="color:#a6e22e">DeserializeData</span>()
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    int32 DeserializedInt <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>    TArray<span style="color:#f92672">&lt;</span>uint8<span style="color:#f92672">&gt;</span> Buffer; <span style="color:#75715e">// Assume this buffer has been filled with data
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// Create a memory reader to deserialize data
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        FMemoryReader Reader(Buffer, true <span style="color:#75715e">/*bDeserializeAsSingleBlock*/</span>);
</span></span><span style="display:flex;"><span>        Reader <span style="color:#f92672">&lt;&lt;</span> DeserializedInt;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h3 id="explanation">Explanation</h3>
<ul>
<li><strong><code>FMemoryWriter</code></strong>: Writes data to a <code>TArray&lt;uint8&gt;</code> buffer. The <code>bSerializeAsSingleBlock</code> flag optimizes memory usage by serializing the data in one contiguous block.</li>
<li><strong><code>FMemoryReader</code></strong>: Reads data from a <code>TArray&lt;uint8&gt;</code> buffer. The <code>bDeserializeAsSingleBlock</code> flag optimizes memory access during deserialization.</li>
</ul>
<p>These classes simplify the process of packing and unpacking data, allowing you to focus on higher-level functionality without worrying about manual offset calculations.</p>
<h2 id="conclusion">Conclusion</h2>
<p>Whether you&rsquo;re working with raw C++ or leveraging Unreal Engine&rsquo;s built-in classes, managing buffers and memory efficiently is crucial for effective data handling. Unreal Engine&rsquo;s <code>FMemoryReader</code> and <code>FMemoryWriter</code> provide powerful abstractions that streamline these processes, making your development workflow smoother and more robust.</p>
<hr>

  
  <hr>
<div class="footer">
    
	    
            <a class="previous-post" href="https://mrdrelliot.github.io/posts/networking/networkserialization/?ref=footer"><span style="font-weight:bold;">« Previous</span><br>Network Serialization in Unreal Engine C++</a>
        
	    
            <div class="next-post">
                <a href="https://mrdrelliot.github.io/posts/gas/intro/?ref=footer"><span style="font-weight:bold;">Next »</span><br>Intro</a>
            </div>
        
    
</div>

  
</div>
            </main>
            
  
    <div class="article-toc ">
    <div class="toc-wrapper">
      <h4 id="contents"></h4>
      <nav id="TableOfContents">
  <ul>
    <li><a href="#raw-c-buffer-management">Raw C++ Buffer Management</a></li>
    <li><a href="#simplified-buffer-management-in-unreal-engine">Simplified Buffer Management in Unreal Engine</a>
      <ul>
        <li><a href="#using-fmemorywriter">Using <strong>FMemoryWriter</strong></a></li>
        <li><a href="#using-fmemoryreader">Using <strong>FMemoryReader</strong></a></li>
        <li><a href="#explanation">Explanation</a></li>
      </ul>
    </li>
    <li><a href="#conclusion">Conclusion</a></li>
  </ul>
</nav>
    </div>
</div>

  

        </div>
    </body>
</html>
